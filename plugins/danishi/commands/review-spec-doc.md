---
name: review-spec-doc
description: システム開発の仕様書・設計書などのドキュメントをレビューし、修正提案をMarkdownで出力する
argument-hint: "<input-file-path> <output-file-path|auto>"
allowed-tools: ["Bash", "Glob", "Grep", "Read", "Write", "Task"]
---

# 目的
指定されたドキュメント（仕様書/設計書/要件定義など）をレビューし、誤字脱字、表現の一貫性、情報の網羅性、設計観点の不足を指摘し、修正案を提示する
レビュー結果はMarkdownとして保存する

# 入力
- input-file-path: レビュー対象のファイルパス
- output-file-path|auto: 出力先のMarkdown
  - "auto" または省略相当の場合は `review_[ドキュメント名].md` を使用する

# 事前条件（必ず満たす）
1. input-file-path が存在し、Read で読み取れる
2. output-file-path の親ディレクトリが存在する（存在しない場合は作成する）
3. 失敗した場合は原因と対処案を提示して終了する（中途半端に出力しない）

# 行動手順（必ず順番通りに実施）
## 1. 対象ドキュメントの読み込み
- Read で対象を全文取得する
- ドキュメントの種類（要件/仕様/基本設計/詳細設計/運用など）を推定し、以降の観点の重みづけを宣言する

## 2. 関連ドキュメントの探索（ワーキングディレクトリ配下）
- 目的: 用語、前提、要件、インターフェース、データ定義、運用条件などの整合性確認のため
- 以下の順で探索し、候補を列挙する
  1) Glob で `**/*.md`, `**/*.txt`, `**/*.adoc`, `**/*.rst` を探索
  2) Grep で対象内の重要キーワード（例: システム名、機能名、外部IF、テーブル名、API名、エラーコード）を抽出し、同キーワードでワーキングディレクトリ全体を検索
  3) README, docs, design ,spec, requirements, architecture, 設計, 仕様, ディレクトリ配下を優先する
- 参照する関連ドキュメントは最大10件まで（重要度順）
- 参照したものは「参照した関連ドキュメント」セクションに必ず記録する

## 3. レビュー実施（観点）
### 3.1 表記・文章（必須ルール）
- 文末の句点（。）は付けないで統一する
- である調で統一する
- 用語、表記ゆれ（例: API/ＡＰＩ、ログインID/login_id）を統一する
- Markdown記法（見出し階層、箇条書き、コードブロック、表）を統一する

### 3.2 誤字脱字・不自然表現
- 誤字脱字、主語述語のねじれ、曖昧語（適宜、必要に応じて、など）の過剰使用を指摘する
- 指摘は「該当箇所（引用）」「理由」「修正案」のセットにする

### 3.3 構造・内容
- 目的、スコープ、前提、用語定義、非機能、例外、制約、依存関係が不足していないか確認する
- 一貫性（他章との矛盾、用語の揺れ、仕様の抜け）を確認する
- 実装・運用で解釈が割れる箇所は、判断基準や具体例を提案する

### 3.4 設計観点（不足情報の指摘）
- インターフェース: 入出力、形式、バリデーション、エラー、リトライ、タイムアウト
- データ: スキーマ、制約、更新方式、整合性、マイグレーション
- セキュリティ: 認証認可、権限、監査ログ、機密情報取り扱い
- 運用: 監視、アラート、バックアップ、障害時手順、SLO/SLA
- テスト: テスト観点、受入条件、サンプルケース

## 4. 出力ファイル作成（必須）
- 必ず Write ツールでMarkdownを保存する
- output-file-path が auto の場合:
  - input-file-path のベース名（拡張子除外）を抽出し `review_[ベース名].md` とする

# 出力品質ルール
- 可能な限り「修正案」はコピペで差し替え可能な形（文章差分・置換提案）にする
- 指摘は重要度を High/Medium/Low で付与する
- まずサマリ（要点一覧）を出し、その後に詳細を書く
- 参照した関連ドキュメントと、そこから得た示唆を明記する

# レビューレポートの構成（Markdown）
```markdown
# レビュー結果：[ドキュメント名]

**対象ファイル**: `[ファイルパス]`
**レビュー実施日時**: YYYY/MM/DD HH:mm
**ドキュメント種別（推定）**: 要件定義 / 仕様書 / 基本設計 / 詳細設計 / 運用 など

## サマリ
- High:
  - [要点]
- Medium:
  - [要点]
- Low:
  - [要点]

## 誤字脱字・表記ゆれ
- [重要度] 該当箇所: 「...（引用）...」
  - 理由: ...
  - 修正案: ...

## 構造・内容の不備
### 指摘1：[問題の概要]
- 重要度: High/Medium/Low
- 該当箇所: 「...（引用）...」
- 影響: 実装/運用/テストでのリスク
- 提案: 追加すべき情報 / 再構成案

**修正案（置換）**
```text
（差し替え後の文章案）
